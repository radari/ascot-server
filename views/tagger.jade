-#
-# tagger.jade
-#
-# Created on: November 17, 2012
-#     Author: Valeri Karpov
-#
-# View for our image tagger
-#

extends layout

prepend head
  script(src="/javascripts/TaggerViewController.js")
  script(src="/javascripts/adjust_wrappers.js")
  link(rel='stylesheet', href='/stylesheets/taggerPut.css')


block content
 div(ng-controller="TaggerViewController")
    input(type="submit",
          value="Save",
          id="save_button",
          ng-click="finalize('#{look._id}', '#{key}')")
    h2.info Add Image Info
    p.title Title
    input(type="text", 
          placeholder="",
          id="titleField"
          ng-model="idsToLooks['#{look._id}'].title")
    p.title Source
    input(type="text", 
          placeholder="",
          id="sourceField"
          ng-model="idsToLooks['#{look._id}'].source")     
    h2.info Add Tags

    div.look-container
      div#look
        div.magicdiv(style="position: relative")
          img(src="#{look.url}",
              class="uploadedImg",
              ascot_id="#{look._id}",
              adjust_ascot_wrapper="1",
              ng-init="look = '#{look._id}'; loadLook(look)",
              ng-click="addTag(look, $event.pageX, $event.pageY)",
              ng-mousemove="updateDraggingTagPosition(look, $event.pageX, $event.pageY)")
          div.item(ng-repeat="tag in idsToLooks[look].tags",
                   ng-style="{ position : 'absolute', left : tag.position.x + 'px', top : tag.position.y + 'px' }",
                   ng-dblclick="deleteTag(look, tag)",
                   ng-click="startEdittingTag(look, tag)",
                   ng-mousedown="startDraggingTag(look, tag)",
                   ng-mouseup="finishDraggingTag(look, tag)")
            {{tag.index}}
            
          {{idsToEditTag[look] | json}}

          div#overlay(ng-show="isEdittingTag(look)",
                      ng-style="{ position : 'absolute', left : (idsToEditTag[look].position.x + 25) + 'px', top : (idsToEditTag[look].position.y + 25) + 'px' }")
            p Brand
            input(type="text",
                  ng-model="idsToEditTag[look].product.brand")
            br
            p Name
            input(type="text",
                  ng-model="idsToEditTag[look].product.name")
            br
            p Buy URL
            input(type="text",
                  ng-model="idsToEditTag[look].product.buyLink")
            br
            input(type="submit"
                  value="Save Tag",
                  ng-click="finishEdittingTag(look)")
    br
   
